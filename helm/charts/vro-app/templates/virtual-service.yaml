apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: {{ .Values.global.hostnamePrefix }}-virtservice
  labels: {{- toYaml .Values.labels | nindent 4 }}
spec:
  hosts: [{{ .Values.global.endpoint }}.lighthouse.va.gov]
  gateways: [istio-system/ldx-{{ .Values.global.images.services.environment }}-1-{{ .Values.global.environment }}-gateway]
  http:
  - match:
    - uri:
        prefix: /{{ .Values.global.serviceUriPrefix }}
    route:
    - destination:
        host: {{ .Values.global.hostnamePrefix }}-app
        port:
          number: 8080
    headers:
      response:
          remove:
          - Server
