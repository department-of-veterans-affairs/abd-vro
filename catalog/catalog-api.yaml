apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: vro-api
  description: Apis used by the Catalog component of the Virtual Regional Office
  title: Lighthouse Developer Hub Catalog
  tags:
    - java
  links:
    - url: https://github.com/department-of-veterans-affairs/abd-vro/tree/develop/docs/
      title: Docs
      icon: dashboard
    - url: https://backstage.io/
      title: Backstage.io
      icon: web
    - url: https://lighthouseva.slack.com/archives/C020ZR4UL8H
      title: lighthouse-bandicoot slack
      icon: group
  annotations:
    github.com/project-slug: department-of-veterans-affairs/abd-vro
spec:
  type: openapi
  owner: amida
  lifecycle: experimental
  system: amida-api
  # All routes for catalogs entities were found by viewing the @backstage/catalog-client source code
  # @see https://github.com/backstage/backstage/blob/master/packages/catalog-client/src/CatalogClient.ts
  definition: |
  openapi: 3.0.1
  info:
    title: Virtual Regional Office (VRO) Automated Benefits Delivery (ABD)
    description: Provides services to improve benefit delivery services
    contact:
      name: D (Yoom) Lam
      url: https://example.va.gov/
      email: dung.lam1@va.gov
    license:
      name: MIT License
      url: https://github.com/department-of-veterans-affairs/abd-vro/blob/master/LICENSE.md
    version: v1
  servers:
    - url: /
  security:
    - bearer-jwt:
      - read
      - write
  oauth2:
    - read
    - write
  tags:
    - name: ABD-VRO Demo API
      description: Automated Benefit Delivery In-Progress Implementations
    - name: ABD-VRO API
      description: Automated Benefit Delivery Implementations
  paths:
    /v1/health-data-assessment:
      post:
        tags:
          - ABD-VRO API
        summary: Health data assessment
        description: Provides health data assessment for the claim
        operationId: postHealthAssessment
        requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthDataAssessmentRequest'
          required: true
        responses:
          "201":
            description: Created
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/HealthDataAssessmentResponse'
        security:
          - bearer-jwt: []
    /v1/generate_pdf:
      post:
        tags:
          - ABD-VRO API
        summary: Evidence pdf generation launch
        description: Posts health data for a specific patient and diagnostic code to
          launch evidence pdf generation
        operationId: generate_pdf
        requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratePdfRequest'
          required: true
        responses:
          "200":
            description: OK
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/GeneratePdfResponse'
        security:
          - bearer-jwt: []
    /v1/fetch_pdf:
      post:
        tags:
          - ABD-VRO API
        summary: Generated evidence pdf download
        description: Downloads the evidence pdf previously generated by the posted patient
          health data and diagnostic code
        operationId: fetch_pdf
        requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratePdfRequest'
          required: true
        responses:
          "200":
            description: OK
            content:
              application/json:
                schema:
                  type: object
        security:
        - bearer-jwt: []
    /v1/demo/assess_health_data:
      post:
        tags:
        - ABD-VRO Demo API
        summary: Demo assess_health_data
        description: Submit health data for assessment
        operationId: assess_health_data
        requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessHealthDataRequest'
          required: true
        responses:
          "201":
            description: Created
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/AssessHealthDataResponse'
        security:
        - bearer-jwt: []
  components:
    schemas:
      HealthDataAssessmentRequest:
        type: object
        properties:
          veteranIcn:
            type: string
            description: Veteran medical internal control number (EHR id)
            example: "9000682"
          diagnosticCode:
            type: string
            description: Diagnostic code for the claim contention
            example: "7101"
          claimSubmissionId:
            type: string
        description: Claim for which health data assessment requested
      AbdBPMeasurement:
        type: object
        properties:
          code:
            type: string
          display:
            type: string
          unit:
            type: string
          value:
            type: number
      AbdBloodPressure:
        type: object
        properties:
          date:
            type: string
          diastolic:
            $ref: '#/components/schemas/AbdBPMeasurement'
          systolic:
            $ref: '#/components/schemas/AbdBPMeasurement'
          practitioner:
            type: string
          organization:
            type: string
      AbdCondition:
        type: object
        properties:
          text:
            type: string
          code:
            type: string
          abatementDate:
            type: string
          status:
            type: string
          onsetDate:
            type: string
          recordedDate:
            type: string
      AbdEvidence:
        type: object
        properties:
          medications:
            type: array
            items:
              $ref: '#/components/schemas/AbdMedication'
          conditions:
            type: array
            items:
              $ref: '#/components/schemas/AbdCondition'
          procedures:
            type: array
            items:
              $ref: '#/components/schemas/AbdProcedure'
          bp_readings:
            type: array
            items:
              $ref: '#/components/schemas/AbdBloodPressure'
        description: Medical evidence supporting assessment
      AbdMedication:
        type: object
        properties:
          text:
            type: string
          code:
            type: string
          date:
            type: string
          status:
            type: string
          notes:
            type: array
            items:
              type: string
          refills:
            type: integer
            format: int32
          duration:
            type: string
      AbdProcedure:
        type: object
        properties:
          text:
            type: string
          code:
            type: string
          status:
            type: string
          performedDate:
            type: string
          codeSystem:
            type: string
      HealthDataAssessmentResponse:
        type: object
        properties:
          veteranIcn:
            type: string
            description: Veteran medical internal control number (EHR id)
            example: "90653535"
          diagnosticCode:
            type: string
            description: Diagnostic code for the claim contention
            example: "7101"
          evidence:
            $ref: '#/components/schemas/AbdEvidence'
          errorMessage:
            type: string
            description: Error message in the case of an error
      GeneratePdfRequest:
        type: object
        properties:
          claimSubmissionId:
            type: string
            description: Claim submission ID
            example: "0"
          diagnosticCode:
            type: string
            description: Diagnostic code
            example: "6602"
          veteranInfo:
            type: string
            description: JSON string providing data for pdf
            example: "{'first': 'test','middle': 'test', 'last': 'test', 'suffix': 'test',\
              \ 'birthdate': '2000-10-20"
          evidence:
            type: string
            description: JSON string providing data for pdf
            example: "{'bp_readings':[], 'medications':[]"
        description: metadata for fetch_pdf
      GeneratePdfResponse:
        type: object
        properties:
          pdfDocumentJson:
            type: string
            description: JSON results
            example: "{\"claimSubmissionId\":0,\"status\":\"IN_PROGRESS\",\"pdf\":\"\
              \"}"
        description: Metadata describing an GeneratePdfResponse resource
      AssessHealthDataRequest:
        type: object
        properties:
          contention:
            type: string
            description: Type of contention
            example: hypertension
          bp_observations:
            type: string
            description: JSON string response from Lighthouse Observations API
            example: "{\"entry\":[{\"search\":{\"mode\":\"match\"},\"resource\": ..."
        description: metadata for assess_health_data
      AssessHealthDataResponse:
        type: object
        properties:
          bpReadingsJson:
            type: string
            description: JSON results
            example: "{\"bp_readings\": [ ... ]}"
        description: Metadata describing an AssessHealthDataResponse resource
    securitySchemes:
      bearer-jwt:
        type: http
        scheme: bearer
        bearerFormat: JWT
      oauth2:
        type: oauth2
        flows:
          implicit:
            authorizationUrl: http://idp.va.gov/
            scopes:
              read: Read permissions
              write: Write permissions
              delete: Deletion permissions
