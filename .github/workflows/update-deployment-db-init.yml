name: "1. (Internal) Update Deployment - DB Init"
# To deploy updates to db-init image
run-name: "${{inputs.target_env}}: Update deployment: db-init ${{inputs.db_init}}"

on:
  workflow_dispatch:
    inputs:
      target_env:
        description: 'Target LHDI environment'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - qa
        - sandbox
        - prod-test
        - prod
      db_init:
        description: 'db-init image tag'
        required: true
        default: 'latest'
        type: string

  # Allow other workflows to call this one
  workflow_call:
    inputs:
      target_env:
        required: true
        type: string
      db_init:
        required: false
        type: string
        default: "latest"

jobs:
  update-deployment-app:
    uses: ./.github/workflows/update-deployment.yml
    secrets: inherit
    with:
      target_env: ${{ inputs.target_env }}
      helm_chart: db-init
      deploy_prep_script: |
        export dbinit_VER=${{ inputs.db_init }}
