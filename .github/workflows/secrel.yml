name: "SecRel workflow"

on:
  # Trigger on every code push to main and develop branches
  push:
    branches: [ main, qa, develop ]

  # Trigger on all published GitHub Releases
  release:
    types: [ "created" ]

  # Trigger manually
  workflow_dispatch:

env:
  # If SecRel can't push signed images, revert to use `secrets.ACCESS_TOKEN` instead.
  # secrets.ACCESS_TOKEN_GRADLE_BUILD only has `read:packages` permission
  # while secrets.ACCESS_TOKEN has `repo` and `write:packages` permission
  GITHUB_ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN_GRADLE_BUILD }}

jobs:
  build-and-scan:
    # only run for the internal repo
    if: github.repository == 'department-of-veterans-affairs/abd-vro-internal'
    name: Tornado Pipeline
    uses: department-of-veterans-affairs/lighthouse-tornado-secrel-pipeline/.github/workflows/pipeline.yml@v3.2.0
    with:
      config-file: .github/secrel/config.yml
    secrets: inherit
