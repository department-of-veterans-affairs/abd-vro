name: "9. Delete old GitHub releases and tags"
on:
  #schedule:
    # Run at 00:00 twice a month.
    # https://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html#tag_20_25_07
    #- cron: '0 0 6,20 * *'

  # Allow manual triggering
  workflow_dispatch:
    inputs:
#      retain_days:
#        description: 'Delete images older than this many days'
#        required: true
#        type: number
#        default: 30
      keep_last:
        description: 'Minimum versions to keep'
        required: true
        type: number
        default: 10
      tag_pattern:
        description: 'Tag pattern to delete'
        required: true
        type: string
        default: release-1.0

jobs:
  delete_releases:
    runs-on: ubuntu-latest
    steps:
    - name: "Delete old images in GHCR"
      uses: dev-drprasad/delete-older-releases@v0.2.1
      with:
        delete_tags: true
        keep_latest: ${{ inputs.keep_last }}
        delete_tag_pattern:  ${{ inputs.tag_pattern }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
