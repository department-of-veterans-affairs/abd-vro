name: "3. Continuous Integration (run tests and checks)"
# Runs tests and checks with merged code in the public repo so that the PR author is notified of failures.
# The SecRel workflow (in the internal repo) publishes `dev_` images, regardless of test failures, for manual testing.
# See https://github.com/department-of-veterans-affairs/abd-vro/wiki/CI-CD-Workflows

on:
  push:
    branches: [ develop, domain-* ]

  # Allow manual triggering
  workflow_dispatch:

jobs:
  lint-and-test:
    uses: ./.github/workflows/test-code.yml
    secrets: inherit

  codeql:
    # TODO: Once working, replace with uses: ./.github/workflows/codeql-analysis.yml
    uses: ./.github/workflows/codeql.yml
    secrets: inherit

#  end2end-test:
#    uses: ./.github/workflows/rrd-end2end-test.yml
#    secrets: inherit
