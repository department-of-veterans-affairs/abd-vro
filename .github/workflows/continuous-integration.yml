name: "CI"
# Runs Continuous Integration tests and checks
# See https://github.com/department-of-veterans-affairs/abd-vro/wiki/CI-CD-Workflows

on:
  pull_request:
    branches: [main, develop, domain-*]
    types: [ready_for_review, synchronize, opened, reopened]

  push:
    branches: [ develop, domain-* ]

  # Allow manual triggering
  workflow_dispatch:

concurrency:
  group: ci-${{ github.ref || github.run_id }}
  cancel-in-progress: true

jobs:
  lint-and-test:
    uses: ./.github/workflows/test-code.yml
    secrets: inherit

  codeql:
    uses: ./.github/workflows/codeql-analysis.yml
    secrets: inherit

  container-healthchecks:
    uses: ./.github/workflows/container-healthchecks.yml
    secrets: inherit

  xample-domain:
    uses: ./.github/workflows/xample-integration-test.yml
    secrets: inherit

  svc-bgs-api:
    uses: ./.github/workflows/svc-bgs-api-integration-test.yml
    secrets: inherit

  svc-bip-api:
    uses: ./.github/workflows/svc-bip-api-integration-test.yml
    secrets: inherit

  svc-bie-kafka-end-to-end:
    uses: ./.github/workflows/bie-kafka-end2end-test.yml
    secrets: inherit

  ee-ep-merge-end-to-end:
    uses: ./.github/workflows/ee-ep-merge-end-to-end.yml
    secrets: inherit
