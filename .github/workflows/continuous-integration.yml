name: "3. Continuous Integration (run tests and checks)"
# Runs tests and checks with merged code in the public repo so that the PR author is notified of failures.
# The SecRel workflow (in the internal repo) publishes `dev_` images, regardless of test failures, for manual testing.
# See https://github.com/department-of-veterans-affairs/abd-vro/wiki/CI-CD-Workflows

on:
  push:
    branches: [ develop, domain-* ]

  # Allow manual triggering
  workflow_dispatch:

jobs:
  lint-and-test:
    uses: ./.github/workflows/test-code.yml
    secrets: inherit

  codeql:
    uses: ./.github/workflows/codeql-analysis.yml
    secrets: inherit

  container-healthchecks:
    uses: ./.github/workflows/container-healthchecks.yml
    secrets: inherit

  xample-domain:
    uses: ./.github/workflows/xample-integeration-test.yml
    secrets: inherit
