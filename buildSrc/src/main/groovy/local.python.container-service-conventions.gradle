/**
 * Provides docker container settings
 * Based on https://github.com/department-of-veterans-affairs/lighthouse-di-starter-boot/blob/main/buildSrc/src/main/groovy/starter.java.container-spring-conventions.gradle
 */

plugins {
    id 'local.java.container-conventions'
}

docker {
    files "bin/entrypoint.sh"
    buildArgs([ENTRYPOINT_FILE: "entrypoint.sh"])

    // Copy files into build/docker/ folder, where the container image will be built
    copySpec.into(".").from("src"){
        exclude('docker')
    }
    copySpec.into(".").from("../"){
        include("*.py")
    }
}

dockerRun {
    env 'RABBITMQ_PLACEHOLDERS_USERNAME': getEnvOrDefault('DB_SERVICE_PASSWORD', 'also-not-the-service-password'),
        'RABBITMQ_PLACEHOLDERS_USERPASSWORD': getEnvOrDefault('DB_USER_PASSWORD', 'also-not-the-user-password')
}
