# NOTE: the name cannot have underscore
name: abd-vro
owner: VA-OCTO
environment: dev # The .Values.environment is computed by the deploy plugin - it returns//uses values like dev, qa, pre, prod etc
cluster: nonprod
endpoint: dev
# TODO: How is version used? What should this be set to?
version: 0.1
replicaCount: 1

labels:
  api:
    app: abd_vro
  ourapp:
    # This is a workaround -- see https://dsva.slack.com/archives/C04CA47HV96/p1674829709129239?thread_ts=1674772120.997269&cid=C04CA47HV96
#    global: &labels-app-global
#      app: abd_vro
#    pod:
#      <<: *labels-app-global
#      sidecar.istio.io/inject: "false"

images:
  registry: ghcr.io
  org: department-of-veterans-affairs
  # Note the repo name uses a hypen, not underscore
  repo: abd-vro
  services:
    environment: nonprod
# BEGIN image-names.sh replacement block (do not modify this block)
# The following image list is updated by image-names.sh
  app:
    imageName: dev_vro-app
    tag: tagPlaceholder
    imagePullPolicy: Always
  db:
    # Being used as the `pg-isready` container
    imageName: dev_vro-postgres
    tag: tagPlaceholder
    imagePullPolicy: Always
  dbInit:
    imageName: dev_vro-db-init
    tag: tagPlaceholder
    imagePullPolicy: Always
  console:
    imageName: dev_vro-console
    tag: tagPlaceholder
    imagePullPolicy: Always
  serviceDataAccess:
    imageName: dev_vro-service-data-access
    tag: tagPlaceholder
    imagePullPolicy: Always
  pdfGenerator:
    imageName: dev_vro-service-pdfgenerator
    tag: tagPlaceholder
    imagePullPolicy: Always
  serviceAssessClaimDC7101:
    imageName: dev_vro-service-assessclaimdc7101
    tag: tagPlaceholder
    imagePullPolicy: Always
  serviceAssessClaimDC6602:
    imageName: dev_vro-service-assessclaimdc6602
    tag: tagPlaceholder
    imagePullPolicy: Always
# END image-names.sh replacement block (do not modify this block)

resources:
  api:
    requests:
      cpu: 150m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1024Mi
  pgIsReady:
    # TODO: reduce resources since this container requires very little
    limits:
      cpu: 10m
      memory: 256Mi

service:
  api:
    type: ClusterIP
    sourcePort: 8080
    targetPort: 8080
  db:
    # Being used as the `pg-isready` container
    type: ClusterIP
    sourcePort: 5432
    targetPort: 5432

ports:
  - name: http
    containerPort: 8080
    protocol: TCP
  - name: liveness
    containerPort: 8081
    protocol: TCP
  - name: debug
    containerPort: 5005
    protocol: TCP

livenessProbe:
  httpGet:
    path: /liveness
    port: 8081
  initialDelaySeconds: 120
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /readiness
    port: 8081
  initialDelaySeconds: 120
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 3

volumes:
  tracking:
    name: tracking-persistent-storage
    claimName: tracking-efs-claim
    mountPath: /persist/tracking

# autoscaling:
#   enabled: false
#   minReplicas: 1
#   maxReplicas: 100
#   targetCPUUtilizationPercentage: 80
api:
  apiKeySecret: api
  apiKey01: apiKey01
  apiKey02: apiKey02
  vroNonProdKey: vroNonProd

# Needed to connect to DB and for the `db-init` container
postgres:
  dbName: vro
  secretName: postgres
  usernameKey: username
  passwordKey: password
  dbnameKey: dbName
  initDbName: vro
  initUsernameKey: initUsername
  initPasswordKey: initPassword
  urlKey: url
  schemaKey: schema

# Needed to connect to MQ
rabbitmq:
  secretName: rabbitmq
  usernameKey: User
  passwordKey: Pass

mas:
  keyName: mas
  masApiAuthClientId: masApiAuthClientId
  masApiAuthClientSecret: masApiAuthClientSecret
  masApiAuthScope: masApiAuthScope
  masApiAuthTokenUri: masApiAuthTokenUri
  masApiBaseUrl: masApiBaseUrl
  masCollectionAnnotsPath: masCollectionAnnotsPath
  masCollectionStatusPath: masCollectionStatusPath
  masCreateExamOrderPath: masCreateExampOrderPath

bip:
  keyName: bip
  bipApplicationId: bipApplicationId
  bipApplicationIss: bipApplicationIss
  bipClaimSecret: bipClaimSecret
  bipClaimUrl: bipClaimUrl
  bipClaimUserId: bipClaimUserId
  bipEvidenceSecret: bipEvidenceSecret
  bipEvidenceUrl: bipEvidenceUrl
  bipEvidenceUserId: bipEvidenceUserId
  bipStationId: bipStationId
  bipKeyStore: bipKeystore
  bipTrustStore: bipTruststore
  bipPassword: bipPassword
  bipAlias: bipAlias

# Needed to connect to Redis
redis:
  secretName: redis
  passwordKey: redisPassword

dataservice:
  lhTokenUrl: lhTokenUrl
  lhFhirUrl: lhFhirUrl
  lhPrivateKey: lhPrivateKey
  lhAssertionUrl: lhAssertionUrl
  lhAccessClientId: lhAccessClientId
  lhApiAuthUrl: lhApiAuthUrl
  vroAudUrl: vroAudUrl
  lhVroApiKey: lhVroApiKey
  validateToken: validateToken

dbinit:
  secretName: dbinit
  superUsernameKey: superUsername
  superPasswordKey: superPassword
  superDbnameKey: superDbname
  urlKey: url
  usernameKey: username
  passwordKey: password
