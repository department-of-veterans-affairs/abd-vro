/**
 * Setting for running checkstyle
 */

plugins {
    // Apply the java Plugin to add support for Java.
    id 'checkstyle'
}

repositories {
    mavenCentral()
}

configurations {
    checkstyleRules
}

dependencies {
//    checkstyleRules platform('gov.va.starter:checkstyle-bom')
//    checkstyleRules 'gov.va.starter:checkstyle'
}

// Also refer to https://github.com/moznion/gradle-multi-project-checkstyle/blob/master/build.gradle
checkstyle {
    toolVersion "10.12.7"
    configFile = file('checkstyle.xml')
    if(! configFile.exists()){
        configFile = rootProject.file('settings/checkstyle/checkstyle.xml')
    }
    if(! configFile.exists()){
        config project.resources.text.fromUri(getClass().getResource('/checkstyle.xml').toURI())
    }
    // pulls configuration from the va.starter checkstyle jar:
    // config project.resources.text.fromArchiveEntry(configurations.checkstyleRules, 'checkstyle.xml')
    configProperties = [
            'checkstyle.cache.file': "${buildDir}/checkstyle.cache",
    ]
    ignoreFailures = true
    showViolations = true
}

afterEvaluate {
    configurations.all {
        resolutionStrategy.capabilitiesResolution.withCapability("com.google.collections:google-collections") {
            select("com.google.guava:guava:0")
        }
        // and/or
        resolutionStrategy.capabilitiesResolution.withCapability("com.google.guava:listenablefuture") {
            select("com.google.guava:guava:0")
        }
    }
}

checkstyleMain {
    source = "src/main/java"
}
checkstyleTest {
    source = "src/test/java"
}
